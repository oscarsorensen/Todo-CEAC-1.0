<!doctype html>
<html>
  <head>
    <style>
      canvas{border:1px solid grey;}
    </style>
  </head>
  <body>
    <canvas></canvas>
    <script>
      // Declaraci칩n de clases
      class Jugador{
        constructor(){
          this.x = 100;
          this.y = 100;
        }
      }
      class Npc{
        constructor(){
          this.x = Math.random()*512;	// x aleatoria
          this.y = Math.random()*512;	// y aleatoria
        }
      }
      // Condiciones globales de inicio
      var lienzo = document.querySelector("canvas")
      var contexto = lienzo.getContext("2d")
      lienzo.width = 512
      lienzo.height = 512
      var temporizador;
      var jugador = new Jugador();
      var fps = 1000/30;
      var spritepersonaje = new Image()
      spritepersonaje.src = "garfield.png"
      var spritenpc = new Image()
      spritenpc.src = "futte.png"
      // Preparo los NPC
      var npcs = []											// Creo una lista
      var numeronpcs = 10								// Creo una serie de npc
      for(let i = 0;i<numeronpcs;i++){	// Recorro un for
      	npcs.push(new Npc())						// A침ado NPCs a la lista
      }
			inicio()
      
      // Funci칩n de inicio
      function inicio(){
      	console.log("Yo soy el inicio")
        temporizador = setTimeout("bucle()",fps)
      }
      // Funci칩n de bucle
      function bucle(){
        // Primero borramos el canvas anterior
        contexto.clearRect(0,0,512,512)
        // Dibujamos al jugador con su sprite
        contexto.drawImage(spritepersonaje,jugador.x,jugador.y)
        // Ahora dibujo a los NPC
        npcs.forEach(function(npc){
        	contexto.drawImage(spritenpc,npc.x,npc.y)
        })
        // Reiniciamos el bucle
      	clearTimeout(temporizador)
        temporizador = setTimeout("bucle()",fps)
      }
      // Manejadores de eventos
      document.onkeydown = function(e){	// Cuando pulso una tecla
        if(e.key == "w"){					// Arriba
        	jugador.y -= 10
        }else if(e.key == "s"){		// Abajo
        	jugador.y += 10
        }else if(e.key == "a"){		// Izquierda
        	jugador.x -= 10
        }else if(e.key == "d"){		// Derecha
        	jugador.x += 10
        }
      }
    </script>
  </body>
</html>